<html>
	<head>
		<title>RappJobos</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link href="css/jquery.mobile-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.mobile.theme-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.mobile.structure-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.mobile.inline-svg-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.mobile.inline-png-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.mobile.icons-1.4.5.min.css" rel="stylesheet" type="text/css"/>
		<link href="css/style.css" rel="stylesheet" type="text/css"/>
		<link href="css/bar-ui.css" rel="stylesheet" type="text/css"/>
		<script src="js/jquery.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="js/sdk-2.0.0.js"></script>
		<script src="script/soundmanager2-nodebug-jsmin.js"></script>
		<script src="script/bar-ui.js"></script>
		<script src="script/demo.js"></script>		
		<script>
			//Rajobos: 135802134
			//Kevin: 166601907
			$(document).on('pageinit', function() {
					var mySound, canciones ="",posicion=1;
					var url = 'https://api.soundcloud.com/tracks/?client_id=f36abe5e283bc2059b1f55507af890eb&user_id=135802134';
						$.getJSON(url, function(tracks) {
							$(tracks).each(function(index,value) {
								if(value.artwork_url==null) 
					 				value.artwork_url = "img/cover.jpg";
				 					canciones +="<li data-posicion='"+posicion+"' class='play_song' data-id='"+value.id+"' data-stream='"+value.stream_url+"'><a class='ui-btn' href='index.html'><img src='"+value.artwork_url+"' /><h3>"+value.title+"</h3><p>"+value.user.username+"</p></a></li>";
				 				$(".ultimas_canciones").html(canciones);
				 				$(".ultimas_canciones").listview("refresh");
				 				posicion++;

								soundManager.createSound({
							    	id: value.id,
							    	url: value.stream_url+"?client_id=f36abe5e283bc2059b1f55507af890eb"
							    });
						});
					});
	
				$(".ultimas_canciones").on("click","li",function() {
					var id = $(this).attr("data-id");
					playSong(id);
					
				});
				$(".playBtn").click(function() {tooglePause()});
			});
			function playNext(posicion) {
				var nuevaposicion = parseInt(posicion)+parseInt(1);
				soundManager.stopAll();
				if($("li[data-posicion='"+nuevaposicion+"']").length==0) 
					posicion = 1;
				else
					posicion = nuevaposicion;

				playSong($("li[data-posicion='"+posicion+"']").attr("data-id"));
			}

			function playSong(id) {
				var posicion = $("li[data-id='"+id+"']").attr("data-posicion");
				var titulo = $("li[data-id='"+id+"']").find("h3").html();
				$(".media-info").html(titulo);
				soundManager.stopAll();
		  		soundManager.play(id,{
		  			onplay:function() {
		  				$(".play a").attr("data-playing","true");
						$(".play a").html("Pause");
		  			},
			  		onfinish:function() {
			  			playNext(posicion);
			  		}
		  		});
			}

			function tooglePause() {
				if($(".play a").attr("data-playing")=="true"){
					soundManager.pauseAll();
					$(".play a").attr("data-playing","false");
					$(".play a").html("Play");
				}
				else if($(".play a").attr("data-playing")=="false"){
					soundManager.resumeAll();
					$(".play a").attr("data-playing","true");
					$(".play a").html("Pause");
				}
			}
		</script>
	</head>
	<body>
		<div data-role="page">
			<div data-role="header"><img src="img/logo.png" /></div>
			<div data-role="content" style="margin:auto" class="ui-content" role="main">
				<ul class="ui-listview ultimas_canciones" data-split-theme="a" data-split-icon="gear" data-role="listview"></ul>
			</div>
			<div class="soundbar">
				<div class="play"><a class="playBtn" href="#" data-playing="false">Play</a></div>
				<div class="media-info">TÃ­tulo</div>
				<div class="duration">0:00</div>
				<div class="clear"></div>
			</div>
		</div>
	</body>
</html>